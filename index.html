<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plagiarism Checker - Multi-Algorithm Detection</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      --radius: 12px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    .header {
      background: var(--card-bg);
      padding: 24px 32px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }
    .brand { display: flex; align-items: center; gap: 16px; }
    .brand-logo {
      width: 48px; height: 48px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
      font-size: 24px;
    }
    .brand-text h1 { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
    .brand-text p { font-size: 13px; color: var(--text-muted); }
    .header-badge {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 16px;
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
      border: 1px solid #bfdbfe;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      color: var(--primary-dark);
    }
    .status-dot {
      width: 8px; height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s ease infinite;
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 28px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border);
    }
    .card-header h2 { font-size: 18px; font-weight: 700; }
    .info-pill {
      padding: 6px 12px;
      background: #f1f5f9;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }
    .algorithm-count {
      padding: 6px 12px;
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      color: #92400e;
    }
    .text-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    .input-group { display: flex; flex-direction: column; gap: 10px; }
    .input-group label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      font-weight: 600;
    }
    .char-count {
      font-size: 11px;
      color: var(--text-muted);
      padding: 3px 8px;
      background: #f1f5f9;
      border-radius: 6px;
    }
    textarea {
      width: 100%;
      min-height: 180px;
      padding: 14px;
      border: 2px solid var(--border);
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      resize: vertical;
      background: #f8fafc;
    }
    textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: white;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .controls {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 200ms;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
    }
    .btn-secondary { background: #f1f5f9; color: var(--text); }
    .btn-secondary:hover { background: #e2e8f0; }
    .web-check-section {
      margin-top: 20px;
      padding: 16px;
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-radius: 10px;
      border: 2px solid #fbbf24;
    }
    .web-check-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .web-check-header h3 {
      font-size: 15px;
      font-weight: 700;
      color: #92400e;
    }
    .toggle { position: relative; width: 48px; height: 26px; }
    .toggle input { opacity: 0; width: 0; height: 0; }
    .slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background: #cbd5e1;
      border-radius: 999px;
      transition: 0.3s;
    }
    .slider::before {
      content: '';
      position: absolute;
      height: 18px;
      width: 18px;
      left: 4px;
      bottom: 4px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
    }
    .toggle input:checked + .slider { background: var(--success); }
    .toggle input:checked + .slider::before { transform: translateX(22px); }
    .web-check-info { font-size: 12px; color: #92400e; }
    .score-display { margin-bottom: 24px; }
    .main-score { text-align: center; margin-bottom: 32px; }
    .score-circle {
      position: relative;
      width: 140px;
      height: 140px;
      margin: 0 auto 16px;
    }
    .score-circle svg {
      transform: rotate(-90deg);
      width: 100%;
      height: 100%;
    }
    .circle-bg {
      fill: none;
      stroke: #e2e8f0;
      stroke-width: 8;
    }
    .circle-progress {
      fill: none;
      stroke: url(#scoreGradient);
      stroke-width: 8;
      stroke-dasharray: 339.292;
      stroke-dashoffset: 339.292;
      stroke-linecap: round;
      transition: stroke-dashoffset 1s ease;
    }
    .score-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: baseline;
      gap: 2px;
    }
    .score-value { font-size: 42px; font-weight: 800; }
    .score-unit {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-muted);
    }
    .score-label {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-muted);
    }
    .algorithm-results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
    }
    .algo-card {
      padding: 16px;
      background: linear-gradient(135deg, #f8fafc, #f1f5f9);
      border: 2px solid var(--border);
      border-radius: 10px;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 200ms;
    }
    .algo-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    }
    .algo-icon {
      font-size: 24px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      border-radius: 8px;
    }
    .algo-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .algo-name {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
    }
    .algo-score { font-size: 20px; font-weight: 800; }
    .details-section {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .detail-card {
      padding: 20px;
      background: #f8fafc;
      border-radius: 10px;
      border: 2px solid var(--border);
    }
    .detail-card h3 {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    .breakdown-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .breakdown-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 12px;
      background: white;
      border-radius: 8px;
      font-size: 13px;
    }
    .breakdown-value {
      font-weight: 700;
      color: var(--primary);
    }
    .placeholder {
      font-size: 13px;
      color: var(--text-muted);
      font-style: italic;
      text-align: center;
      padding: 20px;
    }
    .web-results {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .web-source {
      padding: 12px;
      background: white;
      border-radius: 8px;
      border-left: 4px solid var(--danger);
    }
    .web-source-url {
      font-size: 11px;
      color: var(--primary);
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
      text-decoration: none;
    }
    .web-source-title {
      font-size: 12px;
      color: var(--text-muted);
    }
    .web-source-percent {
      font-size: 14px;
      font-weight: 700;
      color: var(--danger);
      margin-top: 6px;
    }
    .highlights {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.8;
      max-height: 300px;
      overflow-y: auto;
      padding: 14px;
      background: white;
      border-radius: 8px;
    }
    .highlight-match {
      background: linear-gradient(120deg, #fef08a, #fde047);
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 600;
    }
    .footer {
      background: rgba(255, 255, 255, 0.95);
      padding: 20px 32px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      text-align: center;
    }
    .footer p {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .hotkey {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-top: 8px;
    }
    kbd {
      padding: 4px 8px;
      background: #f1f5f9;
      border: 2px solid #e2e8f0;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
    }
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 20px;
      z-index: 1000;
    }
    .loading-overlay.active { display: flex; }
    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-overlay p {
      color: white;
      font-size: 16px;
      font-weight: 600;
    }
    @media (max-width: 1024px) {
      .main-grid, .text-inputs { grid-template-columns: 1fr; }
    }
    @media (max-width: 640px) {
      body { padding: 12px; }
      .header, .card { padding: 20px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="brand-logo">üìã</div>
        <div class="brand-text">
          <h1>Advanced Plagiarism Detector</h1>
          <p>Multi-Algorithm Similarity Analysis System</p>
        </div>
      </div>
      <div class="header-badge">
        <span class="status-dot"></span>
        <span>5 Algorithms Active</span>
      </div>
    </header>

    <main class="main-grid">
      <section class="card">
        <div class="card-header">
          <h2>üìù Text Input</h2>
          <div class="info-pill">Original vs Check</div>
        </div>

        <div class="text-inputs">
          <div class="input-group">
            <label>
              <span>Original Text (Reference)</span>
              <span class="char-count" id="originalCount">0 chars</span>
            </label>
            <textarea id="originalText" placeholder="Paste the original/reference text here..."></textarea>
          </div>

          <div class="input-group">
            <label>
              <span>Text to Check (Student Work)</span>
              <span class="char-count" id="checkCount">0 chars</span>
            </label>
            <textarea id="checkText" placeholder="Paste the text you want to check for plagiarism..."></textarea>
          </div>
        </div>

        <div class="controls">
          <button class="btn btn-secondary" id="swapBtn">üîÑ Swap Texts</button>
          <button class="btn btn-secondary" id="clearBtn">üóëÔ∏è Clear All</button>
          <button class="btn btn-primary" id="analyzeBtn">üöÄ Analyze Plagiarism</button>
        </div>

        <div class="web-check-section">
          <div class="web-check-header">
            <h3>üåê Online Source Checking</h3>
            <label class="toggle">
              <input type="checkbox" id="webCheckToggle">
              <span class="slider"></span>
            </label>
          </div>
          <p class="web-check-info">Enable to simulate checking against web sources (Demo mode)</p>
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <h2>üìä Analysis Results</h2>
          <div class="algorithm-count" id="algorithmCount">0/5 completed</div>
        </div>

        <div class="score-display">
          <div class="main-score">
            <div class="score-circle">
              <svg viewBox="0 0 120 120">
                <defs>
                  <linearGradient id="scoreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
                    <stop offset="50%" style="stop-color:#f59e0b;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#ef4444;stop-opacity:1" />
                  </linearGradient>
                </defs>
                <circle cx="60" cy="60" r="54" class="circle-bg"></circle>
                <circle cx="60" cy="60" r="54" class="circle-progress" id="circleProgress"></circle>
              </svg>
              <div class="score-text">
                <span class="score-value" id="mainScore">0</span>
                <span class="score-unit">%</span>
              </div>
            </div>
            <div class="score-label" id="scoreLabel">Awaiting Analysis</div>
          </div>

          <div class="algorithm-results">
            <div class="algo-card"><div class="algo-icon">üìê</div><div class="algo-info"><span class="algo-name">Cosine Similarity</span><span class="algo-score" id="score-cosine">--</span></div></div>
            <div class="algo-card"><div class="algo-icon">üéØ</div><div class="algo-info"><span class="algo-name">Jaccard Index</span><span class="algo-score" id="score-jaccard">--</span></div></div>
            <div class="algo-card"><div class="algo-icon">üìè</div><div class="algo-info"><span class="algo-name">Levenshtein Distance</span><span class="algo-score" id="score-levenshtein">--</span></div></div>
            <div class="algo-card"><div class="algo-icon">üé≤</div><div class="algo-info"><span class="algo-name">Dice Coefficient</span><span class="algo-score" id="score-dice">--</span></div></div>
            <div class="algo-card"><div class="algo-icon">üîó</div><div class="algo-info"><span class="algo-name">Word Overlap</span><span class="algo-score" id="score-overlap">--</span></div></div>
          </div>
        </div>

        <div class="details-section">
          <div class="detail-card">
            <h3>üîç Algorithm Breakdown</h3>
            <div class="breakdown-content" id="breakdownContent">
              <p class="placeholder">Run analysis to see detailed breakdown</p>
            </div>
          </div>
          <div class="detail-card" id="webResultsCard" style="display: none;">
            <h3>üåê Web Sources Found</h3>
            <div class="web-results" id="webResults"></div>
          </div>
          <div class="detail-card">
            <h3>‚ú® Highlighted Matches</h3>
            <div class="highlights" id="highlights">
              <p class="placeholder">Matching words will appear here</p>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <p>üí° <strong>For CS Project:</strong> Uses 5 algorithms - Cosine Similarity, Jaccard Index, Levenshtein Distance, Dice Coefficient, and Word Overlap</p>
      <p class="hotkey">Press <kbd>Ctrl</kbd> + <kbd>Enter</kbd> to analyze</p>
    </footer>
  </div>

  <div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p>Analyzing with multiple algorithms...</p>
  </div>

  <script>
  (function() {
    'use strict';
    console.log('üöÄ Plagiarism Checker Starting...');
    
    // ============ ALGORITHMS ============
    var PlagiarismAlgorithms = {
      tokenize: function(text) {
        return text.toLowerCase().replace(/[^\w\s]/g, ' ').split(/\s+/).filter(function(word) { return word.length > 2; });
      },
      
      getBigrams: function(text) {
        var words = this.tokenize(text);
        var bigrams = [];
        for (var i = 0; i < words.length - 1; i++) {
          bigrams.push(words[i] + ' ' + words[i + 1]);
        }
        return bigrams;
      },
      
      cosineSimilarity: function(text1, text2) {
        var words1 = this.tokenize(text1);
        var words2 = this.tokenize(text2);
        var allWords = {};
        for (var i = 0; i < words1.length; i++) allWords[words1[i]] = true;
        for (var i = 0; i < words2.length; i++) allWords[words2[i]] = true;
        var uniqueWords = Object.keys(allWords);
        var vector1 = [];
        var vector2 = [];
        for (var i = 0; i < uniqueWords.length; i++) {
          var word = uniqueWords[i];
          var count1 = 0;
          var count2 = 0;
          for (var j = 0; j < words1.length; j++) {
            if (words1[j] === word) count1++;
          }
          for (var k = 0; k < words2.length; k++) {
            if (words2[k] === word) count2++;
          }
          vector1.push(count1);
          vector2.push(count2);
        }
        var dotProduct = 0;
        var magnitude1 = 0;
        var magnitude2 = 0;
        for (var i = 0; i < vector1.length; i++) {
          dotProduct += vector1[i] * vector2[i];
          magnitude1 += vector1[i] * vector1[i];
          magnitude2 += vector2[i] * vector2[i];
        }
        magnitude1 = Math.sqrt(magnitude1);
        magnitude2 = Math.sqrt(magnitude2);
        if (magnitude1 === 0 || magnitude2 === 0) return 0;
        return Math.round((dotProduct / (magnitude1 * magnitude2)) * 100);
      },
      
      jaccardSimilarity: function(text1, text2) {
        var words1 = this.tokenize(text1);
        var words2 = this.tokenize(text2);
        var set1 = {};
        var set2 = {};
        for (var i = 0; i < words1.length; i++) set1[words1[i]] = true;
        for (var i = 0; i < words2.length; i++) set2[words2[i]] = true;
        var intersection = 0;
        var union = {};
        for (var word in set1) {
          union[word] = true;
          if (set2[word]) intersection++;
        }
        for (var word in set2) {
          union[word] = true;
        }
        var unionSize = Object.keys(union).length;
        if (unionSize === 0) return 0;
        return Math.round((intersection / unionSize) * 100);
      },
      
      levenshteinSimilarity: function(text1, text2) {
        var s1 = text1.toLowerCase().trim();
        var s2 = text2.toLowerCase().trim();
        if (s1.length === 0 || s2.length === 0) return 0;
        var matrix = [];
        for (var i = 0; i <= s1.length; i++) {
          matrix[i] = [i];
        }
        for (var j = 0; j <= s2.length; j++) {
          matrix[0][j] = j;
        }
        for (var i = 1; i <= s1.length; i++) {
          for (var j = 1; j <= s2.length; j++) {
            if (s1[i - 1] === s2[j - 1]) {
              matrix[i][j] = matrix[i - 1][j - 1];
            } else {
              matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j] + 1);
            }
          }
        }
        var distance = matrix[s1.length][s2.length];
        var maxLength = Math.max(s1.length, s2.length);
        return Math.round(((maxLength - distance) / maxLength) * 100);
      },
      
      diceSimilarity: function(text1, text2) {
        var bigrams1 = this.getBigrams(text1);
        var bigrams2 = this.getBigrams(text2);
        if (bigrams1.length === 0 || bigrams2.length === 0) return 0;
        var set1 = {};
        var set2 = {};
        for (var i = 0; i < bigrams1.length; i++) set1[bigrams1[i]] = true;
        for (var i = 0; i < bigrams2.length; i++) set2[bigrams2[i]] = true;
        var matches = 0;
        for (var bigram in set1) {
          if (set2[bigram]) matches++;
        }
        var total = bigrams1.length + bigrams2.length;
        return Math.round((2 * matches / total) * 100);
      },
      
      wordOverlap: function(text1, text2) {
        var words1 = this.tokenize(text1);
        var words2 = this.tokenize(text2);
        var set1 = {};
        for (var i = 0; i < words1.length; i++) {
          set1[words1[i]] = true;
        }
        var sharedCount = 0;
        var set2unique = {};
        for (var i = 0; i < words2.length; i++) {
          var word = words2[i];
          if (!set2unique[word]) {
            set2unique[word] = true;
            if (set1[word]) sharedCount++;
          }
        }
        var totalUnique2 = Object.keys(set2unique).length;
        if (totalUnique2 === 0) return 0;
        return Math.round((sharedCount / totalUnique2) * 100);
      },
      
      getMatchingWords: function(text1, text2) {
        var words1 = this.tokenize(text1);
        var words2 = this.tokenize(text2);
        var set1 = {};
        for (var i = 0; i < words1.length; i++) {
          set1[words1[i]] = true;
        }
        var matches = [];
        var added = {};
        for (var i = 0; i < words2.length; i++) {
          var word = words2[i];
          if (set1[word] && !added[word]) {
            matches.push(word);
            added[word] = true;
          }
        }
        return matches;
      }
    };
    
    // ============ ANALYSER ============
    var PlagiarismAnalyser = {
      analyze: function(originalText, checkText, includeWebCheck) {
        var self = this;
        return new Promise(function(resolve, reject) {
          if (!originalText.trim() || !checkText.trim()) {
            reject(new Error('Both texts must contain content'));
            return;
          }
          var results = {
            algorithms: {},
            overallScore: 0,
            webSources: [],
            matchingWords: []
          };
          var algorithms = [
            { name: 'cosine', fn: 'cosineSimilarity', weight: 0.25 },
            { name: 'jaccard', fn: 'jaccardSimilarity', weight: 0.20 },
            { name: 'levenshtein', fn: 'levenshteinSimilarity', weight: 0.15 },
            { name: 'dice', fn: 'diceSimilarity', weight: 0.20 },
            { name: 'overlap', fn: 'wordOverlap', weight: 0.20 }
          ];
          var index = 0;
          function processNext() {
            if (index >= algorithms.length) {
              results.overallScore = self.calculateOverallScore(results.algorithms);
              results.matchingWords = PlagiarismAlgorithms.getMatchingWords(originalText, checkText);
              if (includeWebCheck) {
                setTimeout(function() {
                  results.webSources = self.simulateWebCheck(results.overallScore);
                  resolve(results);
                }, 500);
              } else {
                resolve(results);
              }
              return;
            }
            var algo = algorithms[index];
            setTimeout(function() {
              var score = PlagiarismAlgorithms[algo.fn](originalText, checkText);
              results.algorithms[algo.name] = {
                score: score,
                weight: algo.weight,
                name: self.getAlgorithmName(algo.name)
              };
              index++;
              processNext();
            }, 300);
          }
          processNext();
        });
      },
      
      calculateOverallScore: function(algorithms) {
        var totalScore = 0;
        var totalWeight = 0;
        for (var algo in algorithms) {
          totalScore += algorithms[algo].score * algorithms[algo].weight;
          totalWeight += algorithms[algo].weight;
        }
        return Math.round(totalScore / totalWeight);
      },
      
      getAlgorithmName: function(key) {
        var names = {
          cosine: 'Cosine Similarity',
          jaccard: 'Jaccard Index',
          levenshtein: 'Levenshtein Distance',
          dice: 'Dice Coefficient',
          overlap: 'Word Overlap'
        };
        return names[key] || key;
      },
      
      simulateWebCheck: function(overallScore) {
        var sources = [
          { url: 'wikipedia.org/article', title: 'Wikipedia Article', matchPercent: overallScore + 10 },
          { url: 'medium.com/blog-post', title: 'Medium Blog', matchPercent: overallScore + 5 },
          { url: 'researchgate.net/publication', title: 'Research Paper', matchPercent: overallScore },
          { url: 'stackoverflow.com/questions', title: 'Stack Overflow', matchPercent: overallScore - 5 }
        ];
        if (overallScore < 30) return [];
        var numSources = Math.min(4, Math.floor(overallScore / 20));
        var result = [];
        for (var i = 0; i < numSources; i++) {
          result.push({
            url: sources[i].url,
            title: sources[i].title,
            matchPercent: Math.min(95, Math.round(sources[i].matchPercent))
          });
        }
        return result;
      },
      
      generateBreakdown: function(algorithms) {
        var breakdown = [];
        for (var key in algorithms) {
          var algo = algorithms[key];
          breakdown.push({
            name: algo.name,
            score: algo.score,
            weight: Math.round(algo.weight * 100)
          });
        }
        breakdown.sort(function(a, b) { 
          return (b.score * b.weight) - (a.score * a.weight); 
        });
        return breakdown;
      }
    };
    
    console.log('‚úÖ Algorithms loaded!');
    
    // ============ UI CONTROLLER ============
    var text1 = document.getElementById('originalText');
    var text2 = document.getElementById('checkText');
    var count1 = document.getElementById('originalCount');
    var count2 = document.getElementById('checkCount');
    var swapBtn = document.getElementById('swapBtn');
    var clearBtn = document.getElementById('clearBtn');
    var analyzeBtn = document.getElementById('analyzeBtn');
    var webCheck = document.getElementById('webCheckToggle');
    var loading = document.getElementById('loadingOverlay');
    
    // CHARACTER COUNTING
    if (text1 && count1) {
      text1.addEventListener('input', function() {
        count1.textContent = text1.value.length + ' chars';
      });
    }
    
    if (text2 && count2) {
      text2.addEventListener('input', function() {
        count2.textContent = text2.value.length + ' chars';
      });
    }
    
    console.log('‚úÖ Character counting enabled!');
    
    // SWAP
    if (swapBtn) {
      swapBtn.addEventListener('click', function() {
        var temp = text1.value;
        text1.value = text2.value;
        text2.value = temp;
        count1.textContent = text1.value.length + ' chars';
        count2.textContent = text2.value.length + ' chars';
      });
    }
    
    // CLEAR
    if (clearBtn) {
      clearBtn.addEventListener('click', function() {
        if (confirm('Clear all text and results?')) {
          text1.value = '';
          text2.value = '';
          count1.textContent = '0 chars';
          count2.textContent = '0 chars';
          resetResults();
        }
      });
    }
    
    // ANALYZE
    if (analyzeBtn) {
      analyzeBtn.addEventListener('click', function() {
        var t1 = text1.value.trim();
        var t2 = text2.value.trim();
        if (!t1 || !t2) {
          alert('Please enter both texts!');
          return;
        }
        console.log('üîç Analyzing...');
        loading.classList.add('active');
        resetResults();
        setTimeout(function() {
          PlagiarismAnalyser.analyze(t1, t2, webCheck.checked)
            .then(function(results) {
              console.log('‚úÖ Results:', results);
              displayResults(results);
              loading.classList.remove('active');
            })
            .catch(function(err) {
              alert('Error: ' + err.message);
              loading.classList.remove('active');
            });
        }, 100);
      });
    }
    
    // KEYBOARD
    document.addEventListener('keydown', function(e) {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        if (analyzeBtn) analyzeBtn.click();
      }
    });
    
    function displayResults(results) {
      var score = results.overallScore;
      var algos = results.algorithms;
      var progress = document.getElementById('circleProgress');
      var mainScore = document.getElementById('mainScore');
      var label = document.getElementById('scoreLabel');
      if (progress && mainScore && label) {
        var offset = 339.292 - (score / 100) * 339.292;
        progress.style.strokeDashoffset = offset;
        progress.style.stroke = score >= 70 ? '#ef4444' : score >= 40 ? '#f59e0b' : '#10b981';
        var current = 0;
        var timer = setInterval(function() {
          current += 2;
          if (current >= score) {
            current = score;
            clearInterval(timer);
          }
          mainScore.textContent = Math.round(current);
        }, 20);
        label.textContent = score >= 70 ? '‚ö†Ô∏è High Risk' : score >= 40 ? '‚ö° Medium' : '‚úÖ Low Risk';
        label.style.color = score >= 70 ? '#ef4444' : score >= 40 ? '#f59e0b' : '#10b981';
      }
      var keys = ['cosine', 'jaccard', 'levenshtein', 'dice', 'overlap'];
      var count = 0;
      function updateAlgo(i) {
        if (i >= keys.length) {
          showBreakdown(algos);
          showHighlights(results.matchingWords);
          showWeb(results.webSources);
          return;
        }
        setTimeout(function() {
          var key = keys[i];
          var algo = algos[key];
          var elem = document.getElementById('score-' + key);
          if (elem) elem.textContent = algo.score + '%';
          count++;
          var ac = document.getElementById('algorithmCount');
          if (ac) ac.textContent = count + '/5 completed';
          updateAlgo(i + 1);
        }, 100);
      }
      updateAlgo(0);
    }
    
    function showBreakdown(algos) {
      var breakdown = PlagiarismAnalyser.generateBreakdown(algos);
      var container = document.getElementById('breakdownContent');
      if (!container) return;
      container.innerHTML = '';
      for (var i = 0; i < breakdown.length; i++) {
        var item = breakdown[i];
        var div = document.createElement('div');
        div.className = 'breakdown-item';
        var s1 = document.createElement('span');
        s1.textContent = item.name + ' (' + item.weight + '% weight)';
        var s2 = document.createElement('span');
        s2.className = 'breakdown-value';
        s2.textContent = item.score + '%';
        div.appendChild(s1);
        div.appendChild(s2);
        container.appendChild(div);
      }
    }
    
    function showHighlights(words) {
      var container = document.getElementById('highlights');
      if (!container) return;
      if (!words || words.length === 0) {
        container.innerHTML = '<p class="placeholder">No matches found</p>';
        return;
      }
      var text = text2.value;
      words.sort(function(a,b) { return b.length - a.length; });
      for (var i = 0; i < words.length; i++) {
        var w = words[i].replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        var regex = new RegExp('\\b' + w + '\\b', 'gi');
        text = text.replace(regex, '<span class="highlight-match">$&</span>');
      }
      container.innerHTML = text;
    }
    
    function showWeb(sources) {
      var card = document.getElementById('webResultsCard');
      var container = document.getElementById('webResults');
      if (!card || !container) return;
      if (!sources || sources.length === 0) {
        card.style.display = 'none';
        return;
      }
      card.style.display = 'block';
      container.innerHTML = '';
      for (var i = 0; i < sources.length; i++) {
        var s = sources[i];
        var div = document.createElement('div');
        div.className = 'web-source';
        var a = document.createElement('a');
        a.href = 'https://' + s.url;
        a.target = '_blank';
        a.className = 'web-source-url';
        a.textContent = 'üîó ' + s.url;
        var t = document.createElement('div');
        t.className = 'web-source-title';
        t.textContent = s.title;
        var p = document.createElement('div');
        p.className = 'web-source-percent';
        p.textContent = s.matchPercent + '% match';
        div.appendChild(a);
        div.appendChild(t);
        div.appendChild(p);
        container.appendChild(div);
      }
    }
    
    function resetResults() {
      var ms = document.getElementById('mainScore');
      var sl = document.getElementById('scoreLabel');
      var pc = document.getElementById('circleProgress');
      var ac = document.getElementById('algorithmCount');
      if (ms) ms.textContent = '0';
      if (sl) {
        sl.textContent = 'Awaiting Analysis';
        sl.style.color = '#64748b';
      }
      if (pc) pc.style.strokeDashoffset = '339.292';
      if (ac) ac.textContent = '0/5 completed';
      var keys = ['cosine', 'jaccard', 'levenshtein', 'dice', 'overlap'];
      for (var i = 0; i < keys.length; i++) {
        var e = document.getElementById('score-' + keys[i]);
        if (e) e.textContent = '--';
      }
      var bc = document.getElementById('breakdownContent');
      if (bc) bc.innerHTML = '<p class="placeholder">Run analysis to see breakdown</p>';
      var hc = document.getElementById('highlights');
      if (hc) hc.innerHTML = '<p class="placeholder">Matching words will appear here</p>';
      var wc = document.getElementById('webResultsCard');
      if (wc) wc.style.display = 'none';
    }
    
    console.log('‚úÖ ALL READY! Type in textareas to test!');
  })();
  </script> 
</body>
</html>
